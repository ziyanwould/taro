<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>最佳实践 · Taro</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;关于-jsx-支持程度补充说明&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#关于-jsx-支持程度补充说明&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;关于 JSX 支持程度补充说明&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="最佳实践 · Taro"/><meta property="og:type" content="website"/><meta property="og:url" content="https://taro.aotu.io/taro/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;关于-jsx-支持程度补充说明&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#关于-jsx-支持程度补充说明&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;关于 JSX 支持程度补充说明&lt;/h2&gt;
"/><meta property="og:image" content="https://taro.aotu.io/taro/img/logo-taro.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://taro.aotu.io/taro/img/logo-taro.png"/><link rel="shortcut icon" href="/taro/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://jdc.jd.com/demo/talenttest/js/url.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/taro/css/prism.css"/><link rel="stylesheet" href="/taro/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/taro/"><img class="logo" src="/taro/img/logo-taro.png" alt="Taro"/><h2 class="headerTitleWithLogo">Taro</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/taro/docs/README.html" target="_self">文档</a></li><li class=""><a href="/taro/docs/components-desc.html" target="_self">组件库</a></li><li class=""><a href="/taro/docs/api-desc.html" target="_self">API</a></li><li class=""><a href="https://github.com/NervJS/taro" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>教程</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">关于Taro</h3><ul><li class="navListItem"><a class="navItem" href="/taro/docs/README.html">Taro 介绍</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/team.html">Taro 团队</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">快速开始</h3><ul><li class="navListItem"><a class="navItem" href="/taro/docs/GETTING-STARTED.html">安装及使用</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/composition.html">Taro 组成</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/before-dev-remind.html">开发前注意</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/specials.html">特殊问题的处理</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">教程</h3><ul><li class="navListItem"><a class="navItem" href="/taro/docs/spec-for-taro.html">Taro 规范</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/tutorial.html">框架</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/project-config.html">项目配置</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/router.html">路由功能</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/size.html">设计稿及尺寸单位</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/static-reference.html">静态资源引用</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/component-style.html">组件的外部样式和全局样式</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/jsx.html">JSX 简介</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/props.html">组件化 &amp; Props</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/state.html">生命周期 &amp; State</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/event.html">事件处理</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/condition.html">条件渲染</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/list.html">列表渲染</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/children.html">Children 与组合</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/ref.html">Refs 引用</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/envs.html">跨平台开发</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/relations.html">小程序原生作用域获取</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/react-native.html">React Native 端开发流程</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/ui-lib.html">基于 Taro 开发第三方多端 UI 库</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/taroize.html">微信小程序转 Taro</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/taro/docs/best-practice.html">最佳实践</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/debug.html">Debug 指南</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">进阶指南</h3><ul><li class="navListItem"><a class="navItem" href="/taro/docs/config.html">编译配置</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/config-detail.html">编译配置详情</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/async-await.html">异步编程</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/redux.html">使用 Redux</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/mobx.html">使用 Mobx</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/mini-third-party.html">使用小程序原生第三方组件和插件</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/hybrid.html">Taro 代码与小程序代码混写</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/css-modules.html">CSS Modules 的使用</a></li><li class="navListItem"><a class="navItem" href="/taro/docs/CONTRIBUTING.html">CONTRIBUTING</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/nervjs/taro/edit/master/docs/best-practice.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">最佳实践</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="关于-jsx-支持程度补充说明"></a><a href="#关于-jsx-支持程度补充说明" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 JSX 支持程度补充说明</h2>
<p>由于 JSX 中的写法千变万化，我们不能支持到所有的 JSX 写法，同时由于微信小程序端的限制，也有部分 JSX 的优秀用法暂时不能得到很好地支持，特在此补充说明一下对于 JSX 的支持程度</p>
<ul>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/if-statement-in-map-loop.md">不能在包含 JSX 元素的 map 循环中使用 if 表达式</a></li>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/manipulate-jsx-as-array.md">不能使用 Array#map 之外的方法操作 JSX 数组</a></li>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-anonymous-function-in-props.md">不能在 JSX 参数中使用匿名函数</a></li>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-jsx-in-class-method.md">暂不支持在 render() 之外的方法定义 JSX</a></li>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-spread-in-props.md">不能在 JSX 参数中使用对象展开符</a></li>
<li><a href="https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-stateless-function.md">不支持无状态组件</a></li>
</ul>
<p>以上的规则在 Taro 默认生成的模板都有 ESLint 检测，无需做任何配置。如果你的编辑器没有安装 ESLint 插件可以参考以下教程在你的编辑器安装：</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">VSCode</a></li>
<li><a href="https://www.jetbrains.com/help/idea/eslint.html">IntelliJ IDEA(WebStorm 等 JetBrains 系)</a></li>
<li><a href="https://packagecontrol.io/packages/ESLint">Sublime Text</a></li>
</ul>
<p>默认情况下 Taro 的编译器也会对无法运行的代码进行警告，当没有调用栈信息时代码是可以生成的。如果你需要在编译时禁用掉 ESLint 检查，可以在命令前加入 <code>ESLINT=false</code> 参数，例如：</p>
<pre><code class="hljs css language-bash">$ ESLINT<span class="token operator">=</span>false taro build --type weapp --watch
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="最佳编码方式"></a><a href="#最佳编码方式" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳编码方式</h2>
<p>经过较长时间的探索与验证，目前 Taro 在微信小程序端是采用依托于小程序原生自定义组件系统来设计实现 Taro 组件化的，所以目前小程序端的组件化会受到小程序原生组件系统的限制，而同时为了实现以 React 方式编写代码的目标，Taro 本身做了一些编译时以及运行时的处理，这样也带来了一些值得注意的约束，所以有必要阐述一下 Taro 编码上的最佳实践。</p>
<h3><a class="anchor" aria-hidden="true" id="组件样式说明"></a><a href="#组件样式说明" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件样式说明</h3>
<p>微信小程序的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html">自定义组件样式</a>默认是不能受外部样式影响的，例如在页面中引用了一个自定义组件，在页面样式中直接写自定义组件元素的样式是无法生效的。这一点，在 Taro 中也是一样，而这也是与大家认知的传统 web 开发不太一样。</p>
<h3><a class="anchor" aria-hidden="true" id="给组件设置-defaultprops"></a><a href="#给组件设置-defaultprops" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>给组件设置 <code>defaultProps</code></h3>
<p>在微信小程序端的自定义组件中，只有在 <code>properties</code> 中指定的属性，才能从父组件传入并接收</p>
<pre><code class="hljs css language-jsx"><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  properties<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    myProperty<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性名</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token comment">// 类型（必填），目前接受的类型包括：String, Number, Boolean, Object, Array, null（表示任意类型）</span>
      value<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 属性初始值（可选），如果未指定则会根据类型选择一个</span>
      observer<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">,</span> changedPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 属性被改变时执行的函数（可选），也可以写成在 methods 段中定义的方法名字符串, 如：'_propertyChange'</span>
         <span class="token comment">// 通常 newVal 就是新设置的数据， oldVal 是旧数据</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    myProperty2<span class="token punctuation">:</span> String <span class="token comment">// 简化的定义方式</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>而在 Taro 中，对于在组件代码中使用到的来自 <code>props</code> 的属性，会在编译时被识别并加入到编译后的 <code>properties</code> 中，暂时支持到了以下写法</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>property

<span class="token keyword">const</span> <span class="token punctuation">{</span> property <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

<span class="token keyword">const</span> property <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>property
</code></pre>
<p>但是一千个人心中有一千个哈姆雷特，不同人的代码写法肯定也不尽相同，所以 Taro 的编译肯定不能覆盖到所有的写法，而同时可能会有某一属性没有使用而是直接传递给子组件的情况，这种情况是编译时无论如何也处理不到的，这时候就需要大家在编码时给组件设置 <a href="https://nervjs.github.io/taro/docs/component.html#defaultprops"><code>defaultProps</code></a> 来解决了。</p>
<p>组件设置的 <code>defaultProps</code> 会在运行时用来弥补编译时处理不到的情况，里面所有的属性都会被设置到 <code>properties</code> 中初始化组件，正确设置 <code>defaultProps</code> 可以避免很多异常的情况的出现。</p>
<h3><a class="anchor" aria-hidden="true" id="组件传递函数属性名以-on-开头"></a><a href="#组件传递函数属性名以-on-开头" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件传递函数属性名以 <code>on</code> 开头</h3>
<p>在 Taro 中，父组件要往子组件传递函数，属性名必须以 <code>on</code> 开头</p>
<pre><code class="hljs css language-jsx"><span class="token comment">// 调用 Custom 组件，传入 handleEvent 函数，属性名为 `onTrigger`</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

  <span class="token function">handleEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Custom</span> <span class="token attr-name">onTrigger</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleEvent<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Custom</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这是因为，微信小程序端组件化是不能直接传递函数类型给子组件的，在 Taro 中是借助组件的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html">事件机制</a>来实现这一特性，而小程序中传入事件的时候属性名写法为 <code>bindmyevent</code> 或者 <code>bind:myevent</code></p>
<pre><code class="hljs css language-xml"><span class="hljs-comment">&lt;!-- 当自定义组件触发“myevent”事件时，调用“onMyEvent”方法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component-tag-name</span> <span class="hljs-attr">bindmyevent</span>=<span class="hljs-string">"onMyEvent"</span> /&gt;</span>
<span class="hljs-comment">&lt;!-- 或者可以写成 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component-tag-name</span> <span class="hljs-attr">bind:myevent</span>=<span class="hljs-string">"onMyEvent"</span> /&gt;</span>
</code></pre>
<p>所以 Taro 中约定组件传递函数属性名以 <code>on</code> 开头，同时这也和内置组件的事件绑定写法保持一致了。</p>
<h3><a class="anchor" aria-hidden="true" id="小程序端不要在组件中打印传入的函数"></a><a href="#小程序端不要在组件中打印传入的函数" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序端不要在组件中打印传入的函数</h3>
<p>前面已经提到小程序端的组件传入函数的原理，所以在小程序端不要在组件中打印传入的函数，因为拿不到结果，但是 <code>this.props.onXxx &amp;&amp; this.props.onXxx()</code> 这种判断函数是否传入来进行调用的写法是完全支持的。</p>
<h3><a class="anchor" aria-hidden="true" id="小程序端不要将在模板中用到的数据设置为-undefined"></a><a href="#小程序端不要将在模板中用到的数据设置为-undefined" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序端不要将在模板中用到的数据设置为 <code>undefined</code></h3>
<p>由于小程序不支持将 data 中任何一项的 value 设为 <code>undefined</code> ，在 setState 的时候也请避免这么用。你可以使用 null 来替代。</p>
<h3><a class="anchor" aria-hidden="true" id="小程序端不要在组件中打印-thispropschildren"></a><a href="#小程序端不要在组件中打印-thispropschildren" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序端不要在组件中打印 <code>this.props.children</code></h3>
<p>在微信小程序端是通过 <code>&lt;slot /&gt;</code> 来实现往自定义组件中传入元素的，而 Taro 利用 <code>this.props.children</code> 在编译时实现了这一功能， <code>this.props.children</code> 会直接被编译成 <code>&lt;slot /&gt;</code> 标签，所以它在小程序端属于语法糖的存在，请不要在组件中打印它。</p>
<h3><a class="anchor" aria-hidden="true" id="支持-props-传入-jsx"></a><a href="#支持-props-传入-jsx" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>支持 props 传入 JSX</h3>
<blockquote>
<p>自 <code>1.1.9</code> 开始支持</p>
</blockquote>
<p>支持 props 传入 JSX，但是元素传入 JSX 的属性名必须以 <code>render</code> 开头</p>
<p>例如，子组件写法</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">Dialog</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'dialog'</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'header'</span><span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>renderHeader<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'body'</span><span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'footer'</span><span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>renderFooter<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>父组件调用子组件是传入 JSX</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'container'</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Dialog
          renderHeader<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">'welcome-message'</span><span class="token operator">></span>Welcome<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
          <span class="token punctuation">}</span>
          renderFooter<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token operator">&lt;</span>Button className<span class="token operator">=</span><span class="token string">'close'</span><span class="token operator">></span>Close<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
          <span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&lt;</span>View className<span class="token operator">=</span><span class="token string">"dialog-message"</span><span class="token operator">></span>
            Thank you <span class="token keyword">for</span> using Taro<span class="token punctuation">.</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Dialog<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="组件属性传递注意"></a><a href="#组件属性传递注意" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件属性传递注意</h3>
<p>不要以 <code>id</code>、<code>class</code>、<code>style</code> 作为自定义组件的属性与内部 state 的名称，因为这些属性名在微信小程序小程序中会丢失。</p>
<h3><a class="anchor" aria-hidden="true" id="组件-state-与-props-里字段重名的问题"></a><a href="#组件-state-与-props-里字段重名的问题" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件 <code>state</code> 与 <code>props</code> 里字段重名的问题</h3>
<p>不要在 <code>state</code> 与 <code>props</code> 上用同名的字段，因为这些被字段在微信小程序中都会挂在 <code>data</code> 上。</p>
<h3><a class="anchor" aria-hidden="true" id="小程序中页面生命周期-componentwillmount-不一致问题"></a><a href="#小程序中页面生命周期-componentwillmount-不一致问题" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序中页面生命周期 <code>componentWillMount</code> 不一致问题</h3>
<p>由于微信小程序里页面在 <code>onLoad</code> 时才能拿到页面的路由参数，而页面 onLoad 前组件都已经 <code>attached</code> 了。因此页面的 <code>componentWillMount</code> 可能会与预期不太一致。例如：</p>
<pre><code class="hljs css language-jsx"><span class="token comment">// 错误写法</span>
<span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在 willMount 之前无法拿到路由参数</span>
  <span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>params<span class="token punctuation">.</span>abc
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Custom</span> <span class="token attr-name">adc</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abc<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 正确写法</span>
<span class="token function">componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>params<span class="token punctuation">.</span>abc
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    abc
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 增加一个兼容判断</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>abc <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Custom</span> <span class="token attr-name">adc</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abc<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>
</code></pre>
<p>对于不需要等到页面 willMount 之后取路由参数的页面则没有任何影响。</p>
<h3><a class="anchor" aria-hidden="true" id="组件的-constructor-与-render-提前调用"></a><a href="#组件的-constructor-与-render-提前调用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件的 <code>constructor</code> 与 <code>render</code> 提前调用</h3>
<p>很多细心的开发者应该已经注意到了，在 Taro 编译到小程序端后，组件的 <code>constructor</code> 与 <code>render</code> 默认会多调用一次，表现得与 React 不太一致。</p>
<p>这是因为，Taro 的组件编译后就是小程序的自定义组件，而小程序的自定义组件的初始化时是可以指定 <code>data</code> 来让组件拥有初始化数据的。开发者一般会在组件的 <code>constructor</code> 中设置一些初始化的 <code>state</code>，同时也可能会在 <code>render</code> 中处理 <code>state</code>  与 <code>props</code> 产生新的数据，在 Taro 中多出的这一次提前调用，就是为了收集组件的初始化数据，给自定义组件提前生成 <code>data</code> ，以保证组件初始化时能带有数据，让组件初次渲染正常。</p>
<p>所以，在编码时，需要在处理数据的时候做一些容错处理，这样可以避免在 <code>constructor</code> 与 <code>render</code> 提前调用时出现由于没有数据导致出错的情况。</p>
<h3><a class="anchor" aria-hidden="true" id="js-编码必须用单引号"></a><a href="#js-编码必须用单引号" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 编码必须用单引号</h3>
<p>在 Taro 中，JS 代码里必须书写单引号，特别是 JSX 中，如果出现双引号，可能会导致编译错误。</p>
<h3><a class="anchor" aria-hidden="true" id="环境变量-processenv-的使用"></a><a href="#环境变量-processenv-的使用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>环境变量 <code>process.env</code> 的使用</h3>
<p>不要以解构的方式来获取通过 <code>env</code> 配置的 <code>process.env</code> 环境变量，请直接以完整书写的方式 <code>process.env.NODE_ENV</code> 来进行使用</p>
<pre><code class="hljs css language-jsx"><span class="token comment">// 错误写法，不支持</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'development'</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正确写法</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="使用-this-componenttype-来判断当前-tarocomponent-是页面还是组件"></a><a href="#使用-this-componenttype-来判断当前-tarocomponent-是页面还是组件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 <code>this.$componentType</code> 来判断当前 Taro.Component 是页面还是组件</h3>
<p><code>this.$componentType</code> 可能取值分别为 <code>PAGE</code> 和 <code>COMPONENT</code>，开发者可以根据此变量的取值分别采取不同逻辑。</p>
<h3><a class="anchor" aria-hidden="true" id="预加载"></a><a href="#预加载" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>预加载</h3>
<p>在<strong>微信小程序中</strong>，从调用 <code>Taro.navigateTo</code>、<code>Taro.redirectTo</code> 或 <code>Taro.switchTab</code> 后，到页面触发 componentWillMount 会有一定延时。因此一些网络请求可以提前到发起跳转前一刻去请求。</p>
<p>Taro 提供了 <code>componentWillPreload</code> 钩子，它接收页面跳转的参数作为参数。可以把需要预加载的内容通过 <code>return</code> 返回，然后在页面触发 componentWillMount 后即可通过 <code>this.$preloadData</code> 获取到预加载的内容。</p>
<p>注意：调用跳转方法时需要使用<strong>绝对路径</strong>，相对路径不会触发此钩子。</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'isFetching: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isFetching<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$preloadData
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isFetching <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillPreload</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">fetchData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isFetching <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="在小程序中-可以使用-this-preload-函数进行页面跳转传参"></a><a href="#在小程序中-可以使用-this-preload-函数进行页面跳转传参" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在小程序中，可以使用 this.$preload 函数进行页面跳转传参</h3>
<p>用法：<code>this.$preload(key:String|Object, [value: Any])</code></p>
<p>之所以命名为 $preload，因为它也有一点预加载数据的意味。</p>
<p>如果觉得每次页面跳转传参时，需要先把参数 stringify 后加到 url 的查询字符串中很繁琐，可以利用 <code>this.$preload</code> 进行传参。</p>
<p>另外如果传入的是下一个页面的数据请求 promise，也有上一点提到的“预加载”功能，也能够绕过 componentWillMount 延时。不同点主要在于代码管理，开发者可酌情使用。</p>
<p>例子:</p>
<pre><code class="hljs css language-js"><span class="token comment">// 传入单个参数</span>

<span class="token comment">// A 页面</span>
<span class="token comment">// 调用跳转方法前使用 this.$preload</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$preload</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">)</span>
Taro<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">'/pages/B/B'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// B 页面</span>
<span class="token comment">// 可以于 this.$router.preload 中访问到 this.$preload 传入的参数</span>
<span class="token function">componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'preload: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>preload<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<pre><code class="hljs css language-js"><span class="token comment">// 传入多个参数</span>

<span class="token comment">// A 页面</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$preload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  y<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Taro<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">'/pages/B/B'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// B 页面</span>
<span class="token function">componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'preload: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>preload<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="小程序数据-diff"></a><a href="#小程序数据-diff" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序数据 diff</h3>
<p>在真正调用小程序的 setData 方法之前，Taro 会把页面或组件的 state 和当前页面或组件的 data 做一次 diff，只对必要更新的数据做 setData，开发者无需手动优化。</p>
<h5><a class="anchor" aria-hidden="true" id="diff-逻辑"></a><a href="#diff-逻辑" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>diff 逻辑：</h5>
<ol>
<li>全等 =&gt; 跳过</li>
<li>新增字段 =&gt; 使用新值</li>
<li>类型不同 =&gt; 使用新值</li>
<li>类型相同、基础数据类型 =&gt; 使用新值</li>
<li>其中一方为数组，另一方不是 =&gt; 使用新值</li>
<li>都为数组、新数组比旧数组短 =&gt; 使用新值</li>
<li>都为数组、新数组长度大于等于旧数组的长度 =&gt; 逐项 diff、按路径更新</li>
<li>其中一方为 null，另一方不是 =&gt; 使用新值</li>
<li>都为对象，新对象缺少旧对象某些属性 =&gt; 使用新值</li>
<li>都为对象，新对象拥有旧对象所有的属性 =&gt; 逐项 diff、按路径更新</li>
</ol>
<p>例子：</p>
<pre><code class="hljs css language-js"><span class="token comment">// 新值</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
  d<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    z<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 旧值</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  c<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token number">8</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">diff</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
<span class="token comment">/**
 * diff 结果
{
  b: 22,
  d: 4,
  list: [ 1 ],
  'arr[1]': 'a',
  'arr[2]': true,
  'arr[3]': null,
  'arr[4]': 66,
  obj: { x: 5 },
  'foo.x': 8,
  'foo.z': 0
}
*/</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="全局变量"></a><a href="#全局变量" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局变量</h2>
<p>在 Taro 中推荐使用 <code>Redux</code> 来进行全局变量的管理，但是对于一些小型的应用， <code>Redux</code> 就可能显得比较重了，这时候如果想使用全局变量，推荐如下使用。</p>
<p>新增一个自行命名的 <code>JS</code> 文件，例如 <code>global_data.js</code>，示例代码如下</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">const</span> globalData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token keyword">set</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  globalData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token keyword">get</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> globalData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>随后就可以在任意位置进行使用啦</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">set</span> <span class="token keyword">as</span> setGlobalData<span class="token punctuation">,</span> <span class="token keyword">get</span> <span class="token keyword">as</span> getGlobalData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./path/name/global_data'</span>

<span class="token function">setGlobalData</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token function">getGlobalData</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/taro/docs/taroize.html"><span class="arrow-prev">← </span><span>微信小程序转 Taro</span></a><a class="docs-next button" href="/taro/docs/debug.html"><span>Debug 指南</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#关于-jsx-支持程度补充说明">关于 JSX 支持程度补充说明</a></li><li><a href="#最佳编码方式">最佳编码方式</a><ul class="toc-headings"><li><a href="#组件样式说明">组件样式说明</a></li><li><a href="#给组件设置-defaultprops">给组件设置 <code>defaultProps</code></a></li><li><a href="#组件传递函数属性名以-on-开头">组件传递函数属性名以 <code>on</code> 开头</a></li><li><a href="#小程序端不要在组件中打印传入的函数">小程序端不要在组件中打印传入的函数</a></li><li><a href="#小程序端不要将在模板中用到的数据设置为-undefined">小程序端不要将在模板中用到的数据设置为 <code>undefined</code></a></li><li><a href="#小程序端不要在组件中打印-thispropschildren">小程序端不要在组件中打印 <code>this.props.children</code></a></li><li><a href="#支持-props-传入-jsx">支持 props 传入 JSX</a></li><li><a href="#组件属性传递注意">组件属性传递注意</a></li><li><a href="#组件-state-与-props-里字段重名的问题">组件 <code>state</code> 与 <code>props</code> 里字段重名的问题</a></li><li><a href="#小程序中页面生命周期-componentwillmount-不一致问题">小程序中页面生命周期 <code>componentWillMount</code> 不一致问题</a></li><li><a href="#组件的-constructor-与-render-提前调用">组件的 <code>constructor</code> 与 <code>render</code> 提前调用</a></li><li><a href="#js-编码必须用单引号">JS 编码必须用单引号</a></li><li><a href="#环境变量-processenv-的使用">环境变量 <code>process.env</code> 的使用</a></li><li><a href="#使用-this-componenttype-来判断当前-tarocomponent-是页面还是组件">使用 <code>this.$componentType</code> 来判断当前 Taro.Component 是页面还是组件</a></li><li><a href="#预加载">预加载</a></li><li><a href="#在小程序中-可以使用-this-preload-函数进行页面跳转传参">在小程序中，可以使用 this.$preload 函数进行页面跳转传参</a></li><li><a href="#小程序数据-diff">小程序数据 diff</a></li></ul></li><li><a href="#全局变量">全局变量</a></li></ul></nav></div><footer class="footer" id="footer"><div class="footer-container"><div class="footer-logo-container"><div class="footer-logo"></div></div><div class="footer-link-container"><div class="footer-link"><h3>相关资源</h3><p><a class="link" href="https://taro.aotu.io/">Taro</a> - 多端解决方案</p><p><a class="link" href="https://nerv.aotu.io/">Nerv</a> - 类 React 框架</p><p><a class="link" href="https://athena.aotu.io/">Athena</a> - O2 前端流程工具</p><p><a class="link" href="https://at.aotu.io/">AT-UI</a> - Vue 组件库</p></div><div class="footer-link"><h3>社区</h3><p><a href="https://github.com/NervJS/taro/issues">反馈建议</a></p><p><a href="https://github.com/NervJS/taro">GitHub</a></p></div><div class="footer-link"><h3>关于我们</h3><p><a href="https://aotu.io/">凹凸实验室</a></p></div></div></div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '57b9948bff42bc0dbc6c219556fbae35',
                indexName: 'taro',
                inputSelector: '#search_input_react'
              });
            </script></body></html>